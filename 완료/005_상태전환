# ğŸ”„ ìƒíƒœ ì „í™˜ ë‹¤ì´ì–´ê·¸ë¨

CJ AI Dashboard ì»´í¬ë„ŒíŠ¸ë“¤ì˜ ìƒíƒœ ì „í™˜ê³¼ ìƒëª…ì£¼ê¸°ë¥¼ ì‹œê°ì ìœ¼ë¡œ ì„¤ëª…í•˜ëŠ” ë¬¸ì„œì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨
- [Token Balance Widget ìƒíƒœ ì „í™˜](#token-balance-widget-ìƒíƒœ-ì „í™˜)
- [CJ AI Chat Bubble ìƒíƒœ ì „í™˜](#cj-ai-chat-bubble-ìƒíƒœ-ì „í™˜)
- [í†µí•© ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ íë¦„](#í†µí•©-ì• í”Œë¦¬ì¼€ì´ì…˜-ìƒíƒœ-íë¦„)
- [ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬](#ì—ëŸ¬-ìƒíƒœ-ì²˜ë¦¬)
- [ìƒíƒœ ê´€ë¦¬ íŒ¨í„´](#ìƒíƒœ-ê´€ë¦¬-íŒ¨í„´)
- [ìƒíƒœ ì „í™˜ êµ¬í˜„](#ìƒíƒœ-ì „í™˜-êµ¬í˜„)

---

## ğŸ’° Token Balance Widget ìƒíƒœ ì „í™˜

### ê¸°ë³¸ ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨
```mermaid
stateDiagram-v2
    [*] --> Initializing
    
    Initializing --> Loading : ë°ì´í„° ìš”ì²­
    Loading --> Normal : amount > 1,000,000
    Loading --> Warning : 100,000 < amount â‰¤ 1,000,000  
    Loading --> Critical : amount â‰¤ 100,000
    Loading --> Error : ë¡œë“œ ì‹¤íŒ¨
    
    Normal --> Warning : ì”ê³  ê°ì†Œ
    Normal --> Critical : ê¸‰ê²©í•œ ì”ê³  ê°ì†Œ
    Normal --> Refreshing : ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    
    Warning --> Normal : ì”ê³  ì¦ê°€
    Warning --> Critical : ì”ê³  ê³„ì† ê°ì†Œ
    Warning --> Refreshing : ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    
    Critical --> Warning : ì”ê³  ì¦ê°€
    Critical --> Normal : ì”ê³  ëŒ€í­ ì¦ê°€
    Critical --> Refreshing : ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    
    Refreshing --> Normal : ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ (ì •ìƒ)
    Refreshing --> Warning : ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ (ê²½ê³ )
    Refreshing --> Critical : ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ (ìœ„í—˜)
    Refreshing --> Error : ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨
    
    Error --> Loading : ì¬ì‹œë„
    Error --> [*] : ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸
    
    Normal --> [*] : ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸
    Warning --> [*] : ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸
    Critical --> [*] : ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸
    
    state Normal {
        [*] --> Stable
        Stable --> Increasing : change = 'increase'
        Stable --> Decreasing : change = 'decrease'
        Increasing --> Stable : change = 'none'
        Decreasing --> Stable : change = 'none'
        Increasing --> Decreasing : ì¶”ì„¸ ë³€í™”
        Decreasing --> Increasing : ì¶”ì„¸ ë³€í™”
    }
```

### ìƒíƒœë³„ ì†ì„± ì •ì˜
```typescript
export interface TokenWidgetState {
  status: 'initializing' | 'loading' | 'normal' | 'warning' | 'critical' | 'error' | 'refreshing';
  subState?: 'stable' | 'increasing' | 'decreasing' | 'declining' | 'recovering';
  amount: number;
  previousAmount?: number;
  change: ChangeDirection;
  loading: boolean;
  error?: Error | null;
  lastUpdated?: Date;
  isAnimating: boolean;
  animationType?: 'entrance' | 'valueChange' | 'statusChange' | 'exit';
}

export const STATE_THRESHOLDS = {
  CRITICAL_THRESHOLD: 100000,
  WARNING_THRESHOLD: 1000000,
  NORMAL_THRESHOLD: Infinity
} as const;
```

---

## ğŸ’¬ CJ AI Chat Bubble ìƒíƒœ ì „í™˜

### ì±„íŒ… ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨
```mermaid
stateDiagram-v2
    [*] --> Closed
    
    Closed --> Opening : ì‚¬ìš©ì í´ë¦­
    Opening --> Open : ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ
    
    Open --> Typing : ì‚¬ìš©ì ì…ë ¥ ì‹œì‘
    Open --> Closing : ë‹«ê¸° ë²„íŠ¼ í´ë¦­
    
    Typing --> Open : ì…ë ¥ ì¤‘ë‹¨
    Typing --> Sending : ë©”ì‹œì§€ ì „ì†¡
    
    Sending --> WaitingResponse : ì „ì†¡ ì™„ë£Œ
    Sending --> Open : ì „ì†¡ ì‹¤íŒ¨
    
    WaitingResponse --> ReceivingResponse : AI ì‘ë‹µ ì‹œì‘
    WaitingResponse --> Error : ì‘ë‹µ íƒ€ì„ì•„ì›ƒ
    
    ReceivingResponse --> Open : ì‘ë‹µ ì™„ë£Œ
    ReceivingResponse --> Error : ì‘ë‹µ ì—ëŸ¬
    
    Closing --> Closed : ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ
    
    Error --> Open : ì—ëŸ¬ í•´ê²°/ì¬ì‹œë„
    Error --> Closed : ì—ëŸ¬ë¡œ ì¸í•œ ì¢…ë£Œ
    
    Open --> [*] : ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸
    Closed --> [*] : ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸
```

### ì±„íŒ… ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
```typescript
export interface ChatBubbleState {
  status: 'closed' | 'opening' | 'open' | 'typing' | 'sending' | 
          'waitingResponse' | 'receivingResponse' | 'closing' | 'error';
  messages: Message[];
  inputValue: string;
  isLoading: boolean;
  error?: Error | null;
  unreadCount: number;
  isOpen: boolean;
  isAnimating: boolean;
  lastActivity?: Date;
  connectionStatus: 'connected' | 'disconnected' | 'reconnecting';
  aiTyping: boolean;
}
```

---

## ğŸ”„ í†µí•© ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ íë¦„

### ì „ì²´ ì‹œìŠ¤í…œ ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨
```mermaid
flowchart TD
    A[App Initialization] --> B[Load Token Data]
    B --> C[Initialize Chat Bot]
    C --> D[Render Components]
    
    D --> E{User Interaction}
    E -->|Token Simulation| F[Update Token State]
    E -->|Chat Interaction| G[Handle Chat Message]
    
    F --> H[Trigger Animation]
    H --> I[Update UI]
    I --> E
    
    G --> J[Send to AI]
    J --> K[Receive Response]
    K --> L[Update Chat State]
    L --> E
    
    E -->|Window Resize| M[Responsive Update]
    M --> E
```

---

## âš ï¸ ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬

### ì—ëŸ¬ ë³µêµ¬ í”Œë¡œìš°
```mermaid
stateDiagram-v2
    [*] --> Normal
    Normal --> ErrorDetected : ì—ëŸ¬ ë°œìƒ
    ErrorDetected --> ErrorDisplayed : ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
    ErrorDisplayed --> Retrying : ì‚¬ìš©ì ì¬ì‹œë„
    ErrorDisplayed --> UserDismiss : ì‚¬ìš©ì ë¬´ì‹œ
    Retrying --> Normal : ì¬ì‹œë„ ì„±ê³µ
    Retrying --> ErrorDisplayed : ì¬ì‹œë„ ì‹¤íŒ¨
    UserDismiss --> Normal : ì—ëŸ¬ ë¬´ì‹œí•˜ê³  ê³„ì†
```

---

## ğŸ—ï¸ ìƒíƒœ ê´€ë¦¬ íŒ¨í„´

### React Hook ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬
```typescript
export function useTokenWidget(initialAmount: number = 0) {
  const [state, setState] = useState<TokenWidgetState>({
    status: 'initializing',
    amount: initialAmount,
    change: 'none',
    loading: false,
    isAnimating: false
  });

  const updateAmount = useCallback((newAmount: number) => {
    setState(prev => ({
      ...prev,
      amount: newAmount,
      status: getStatusFromAmount(newAmount),
      change: calculateChange(prev.amount, newAmount),
      lastUpdated: new Date()
    }));
  }, []);

  return { state, updateAmount };
}

export function useChatBubble() {
  const [state, setState] = useState<ChatBubbleState>({
    status: 'closed',
    messages: [],
    inputValue: '',
    isLoading: false,
    unreadCount: 0,
    isOpen: false,
    isAnimating: false,
    connectionStatus: 'connected',
    aiTyping: false
  });

  const sendMessage = useCallback(async (message: string) => {
    setState(prev => ({ ...prev, status: 'sending' }));
    // ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§
  }, []);

  return { state, sendMessage };
}
```

---

## ğŸ› ï¸ ìƒíƒœ ì „í™˜ êµ¬í˜„

### ìƒíƒœ ë¨¸ì‹  íŒ©í† ë¦¬
```typescript
export class StateMachineFactory {
  static createTokenWidget(initialAmount: number = 0): TokenWidgetStateMachine {
    return new TokenWidgetStateMachine(initialAmount);
  }

  static createChatBubble(): ChatBubbleStateMachine {
    return new ChatBubbleStateMachine();
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
const tokenMachine = StateMachineFactory.createTokenWidget(1000000);
const chatMachine = StateMachineFactory.createChatBubble();

// ìƒíƒœ êµ¬ë…
tokenMachine.subscribe(state => {
  console.log('Token state changed:', state);
});

chatMachine.subscribe(state => {
  console.log('Chat state changed:', state);
});
```

### ìƒíƒœ ì „í™˜ í…ŒìŠ¤íŠ¸
```typescript
describe('State Transitions', () => {
  it('should transition token widget states correctly', () => {
    const machine = new TokenWidgetStateMachine(2000000);
    
    expect(machine.getState().status).toBe('initializing');
    
    machine.startLoading();
    expect(machine.getState().status).toBe('loading');
    
    machine.updateAmount(50000);
    expect(machine.getState().status).toBe('critical');
  });

  it('should handle chat bubble state transitions', () => {
    const machine = new ChatBubbleStateMachine();
    
    expect(machine.getState().status).toBe('closed');
    
    machine.dispatch({ type: 'OPEN' });
    expect(machine.getState().status).toBe('opening');
  });
});
```

---

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025ë…„ 6ì›” 19ì¼*
*ë²„ì „: 1.0.0*